webpackJsonp([6],{FYG8:function(e,t){},vfZr:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("Gu7T"),o=a.n(s),i=a("qGD+"),r=a("W2KW"),n=a("4/BI"),l={data:function(){var e=this;return{treeData:[],treeProps:{value:"_id",label:"title",children:"children"},sortObj:{sortBy:null,sortOrders:null},dialogBox:{boxShow:!1,isEdit:!1,detailItem:{}},authBox:{boxShow:!1,detailItem:{}},userBox:{boxShow:!1,type:"1",selectName:"",detailItem:{},selectData:[]},tablePage:{pageSize:10,total:0,currentPage:1},userTable:{ref:"userTable",slot:"userOperate",selection:!0,reserveSelection:!0,dataList:[],columns:[{prop:"name",label:"用户名"},{prop:"email",label:"邮箱"},{prop:"phone",label:"手机号码"}]},pageObj:{pageSize:10,total:0,currentPage:1},tableData:{ref:"table",dataList:[],columns:[{prop:"name",sortable:"custom",label:"角色名称"},{prop:"description",showTooltip:!0,label:"角色描述"},{prop:"operate",align:"center",width:600,hide:!0,label:"操作",render:function(t,a){return t("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"}},[t("el-button",{props:{type:"primary",size:"small"},style:{display:e.authList.includes("5e835067fb69305aa091e83b")?"block":"none"},on:{click:function(){e.dialogBox.detailItem=a.row,e.editData(a)}}},"编辑"),t("el-button",{props:{type:"danger",size:"small"},style:{display:e.authList.includes("5e83506dfb69305aa091e83c")?"block":"none"},on:{click:function(){"4"===a.row.type?e.dataDel(a):e.$message.warning("该角色暂不支持删除")}}},"删除"),t("el-button",{props:{type:"warning",size:"small"},style:{display:e.authList.includes("5e99cb85d1ba729a78b016c2")?"block":"none"},on:{click:function(){e.authBox.detailItem=a.row,e.authBox.boxShow=!0,e.$nextTick(function(){e.$refs.tree.setCheckedKeys(a.row.functionList)})}}},"权限分配"),t("el-button",{props:{type:"success",size:"small"},style:{display:e.authList.includes("5e99cb85d1ba729a78b016c2")?"block":"none"},on:{click:function(){e.roleUser("0",a.row)}}},"导入用户"),t("el-button",{props:{type:"info",size:"small"},style:{display:e.authList.includes("5e99cb85d1ba729a78b016c2")?"block":"none"},on:{click:function(){e.roleUser("1",a.row)}}},"移除用户")])}}]},searchForm:{labelWidth:"70px",ref:"searchRef",inline:!0,marginRight:"40px",formItemList:[{type:"text",prop:"name",width:"260px",label:"角色名称",placeholder:"请输入角色名称",blur:this.getDataList}],operate:[{name:"新增角色",hide:!1,handleClick:this.dataAdd}],formModel:{name:""}},roleForm:{labelWidth:"80px",ref:"roleRef",formItemList:[{type:"text",prop:"name",width:"450px",label:"角色名称",placeholder:"请输入角色名称"},{type:"text",prop:"description",width:"450px",label:"角色描述",placeholder:"请输入角色描述"}],formModel:{name:"",description:""},rules:{name:[{required:!0,validator:n.a.FormValidate.Form("角色名称").NoEmpty,trigger:"blur"}]}}}},created:function(){this.searchForm.operate[0].hide=!this.authList.includes("5e83505dfb69305aa091e83a"),this.tableData.columns[2].hide=!this.authList.includes("5e835067fb69305aa091e83b")&&!this.authList.includes("5e83506dfb69305aa091e83c")&&!this.authList.includes("5e99cb85d1ba729a78b016c2")},mounted:function(){this.getDataList(),this.getTreeList()},methods:{getDataList:function(e){var t=this;this.pageObj.currentPage=!0===e?this.pageObj.currentPage:1;var a=this.searchForm.formModel,s=this.sortObj,o=s.sortBy,i=s.sortOrders;this.$api.role.roleList({currentPage:this.pageObj.currentPage,pageSize:this.pageObj.pageSize,name:a.name,sortBy:o,sortOrders:i}).then(function(e){e.code===t.$constant.reqSuccess?(t.pageObj.total=e.data.count,t.tableData.dataList=e.data.data):t.$message.warning("获取角色列表失败")})},getTreeList:function(){var e=this;this.$api.menu.menuTree().then(function(t){if(t.code===e.$constant.reqSuccess){var a=t.data;a.length>0&&e.functionChildList(a),e.treeData=a}else e.$message.warning("获取权限列表失败")})},functionChildList:function(e){var t=this;e.forEach(function(e){e.functionList&&e.functionList.length>0?e.children=e.functionList:e.children&&e.children.length>0&&t.functionChildList(e.children)})},sortChange:function(e){e.order?this.sortObj={sortBy:e.prop,sortOrders:e.order}:this.sortObj={sortBy:null,sortOrders:null},this.getDataList()},dataAdd:function(){this.$refs.roleRef&&this.$refs.roleRef.$refs.roleRef.resetFields(),this.dialogBox.isEdit=!1,this.dialogBox.boxShow=!0},editData:function(e){var t=this;this.dialogBox.isEdit=!0,this.dialogBox.boxShow=!0,this.$nextTick(function(){t.$refs.roleRef&&t.$refs.roleRef.$refs.roleRef.resetFields(),t.roleForm.formModel={name:e.row.name,description:e.row.description}})},confirSubmit:function(){var e=this;this.$refs.roleRef.$refs.roleRef.validate(function(t){var a=e.dialogBox,s=e.roleForm.formModel;t?a.isEdit?e.$api.role.roleUpdate({id:a.detailItem._id,name:s.name,description:s.description}).then(function(t){var a=t.code;a===e.$constant.reqSuccess?(e.dialogBox.boxShow=!1,e.getDataList()):a===e.$constant.dataAlready?(e.$message.warning("角色名称已存在"),s.name=""):e.$message.warning("角色信息更新失败")}):e.$api.role.roleAdd({name:s.name,description:s.description}).then(function(t){var a=t.code;a===e.$constant.reqSuccess?(e.dialogBox.boxShow=!1,e.getDataList()):a===e.$constant.dataAlready?(e.$message.warning("角色名称已存在"),s.name=""):e.$message.warning("角色信息添加失败")}):e.$message.warning("信息校验失败")})},setAuth:function(){var e=this,t=this.authBox,a=this.$refs.tree.getCheckedNodes(),s=this.$refs.tree.getHalfCheckedNodes(),i=[].concat(o()(a),o()(s)),r=[],n=[];i.length>0&&i.forEach(function(e){e.menuId?r.push(e._id):n.push(e._id)}),this.$api.role.setRoleAuth({id:t.detailItem._id,functionList:r.length>0?r.join(","):"",menuList:n.length>0?n.join(","):""}).then(function(a){a.code===e.$constant.reqSuccess?(t.boxShow=!1,e.getDataList(),e.$message.success("角色权限配置成功")):e.$message.warning("角色权限配置失败")})},roleUser:function(e,t){this.userBox.type=e,this.userBox.detailItem=t,this.userBox.selectName="",this.userBox.selectData=[],this.$refs.userTable&&this.$refs.userTable.$refs.userTable.clearSelection(),this.getUser()},getUser:function(e){var t=this,a=this.tablePage,s=this.userBox;a.currentPage=!0===e?a.currentPage:1,this.$api.role.roleUserList({currentPage:a.currentPage,pageSize:a.pageSize,roleId:s.detailItem._id,type:s.type,name:s.selectName}).then(function(e){e.code===t.$constant.reqSuccess?(a.total=e.data.count,t.userTable.dataList=e.data.data,t.userBox.boxShow=!0):t.$message.warning("获取用户列表失败")})},selectChange:function(e){this.userBox.selectData=e},selectRemove:function(e){var t=this;this.$nextTick(function(){t.$refs.userTable.$refs.userTable.toggleRowSelection(e,!1)})},userOperate:function(){var e=this,t=this.userBox;if(t.selectData.length>0){var a="导入用户成功",s="导入用户失败";"1"===t.type&&(a="移除用户成功",s="移除用户失败");var o=[];t.selectData.forEach(function(e){o.push(e._id)}),this.$api.role.updateMuchUser({roleId:t.detailItem._id,type:t.type,ids:o.join(",")}).then(function(o){var i=o.code;i===e.$constant.reqSuccess?(t.boxShow=!1,e.$message.success(a)):i===e.$constant.statusFail?e.$message.warning("选择用户不存在"):e.$message.warning(s)})}else this.$message.warning("请至少选择一个用户")},dataDel:function(e){var t=this;this.$confirm("此操作将删除该用户信息, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$api.role.roleDel(e.row._id).then(function(e){var a=e.code;a===t.$constant.reqSuccess?t.getDataList():a===t.$constant.statusFail?t.$message.warning("该角色不支持删除"):t.$message.warning("角色删除失败")})}).catch(function(){})},clearAlert:function(){this.userBox.selectData=[],this.$refs.userTable.$refs.userTable.clearSelection()},pageChange:function(e){this.pageObj.currentPage=e,this.getDataList(!0)},tablePageChange:function(e){this.tablePage.currentPage=e,this.getUser(!0)}},components:{MyTable:i.a,MyForm:r.a},computed:{authList:function(){return this.$store.getters.getAuthList}}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"wrapper"},[a("h2",{staticClass:"content-title"},[e._v("角色列表")]),e._v(" "),a("div",{staticClass:"box-table"},[a("my-form",{ref:e.searchForm.ref,attrs:{formConfig:e.searchForm}}),e._v(" "),a("my-table",{attrs:{tableData:e.tableData,pageObj:e.pageObj},on:{sortChange:e.sortChange,pageChange:e.pageChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:e.dialogBox.isEdit?"编辑角色":"新增角色",visible:e.dialogBox.boxShow,width:"640px"},on:{"update:visible":function(t){return e.$set(e.dialogBox,"boxShow",t)}},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.confirSubmit(t)}}},[a("my-form",{ref:e.roleForm.ref,attrs:{formConfig:e.roleForm}}),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{nativeOn:{click:function(t){e.dialogBox.boxShow=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.confirSubmit(t)}}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"权限配置",visible:e.authBox.boxShow,width:"640px","custom-class":"tree-dialog"},on:{"update:visible":function(t){return e.$set(e.authBox,"boxShow",t)}}},[a("el-tree",{ref:"tree",attrs:{data:e.treeData,"node-key":"_id",props:e.treeProps,"default-expand-all":"","show-checkbox":""}}),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{nativeOn:{click:function(t){e.authBox.boxShow=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.setAuth(t)}}},[e._v("配 置")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"1"===e.userBox.type?"移除用户":"导入用户",visible:e.userBox.boxShow,width:"840px"},on:{"update:visible":function(t){return e.$set(e.userBox,"boxShow",t)}}},[a("div",{staticClass:"table-header"},[a("el-input",{staticStyle:{width:"280px"},attrs:{clearable:"",placeholder:"输入用户名搜索"},model:{value:e.userBox.selectName,callback:function(t){e.$set(e.userBox,"selectName",t)},expression:"userBox.selectName"}},[a("el-button",{attrs:{slot:"append",type:"info",icon:"el-icon-search"},nativeOn:{click:function(t){return e.getUser(t)}},slot:"append"})],1),e._v(" "),a("el-button",{attrs:{type:0===e.userBox.selectData.length?"info":"primary"},nativeOn:{click:function(t){return e.userOperate(t)}}},[e._v(e._s("1"===e.userBox.type?"移除用户":"导入用户"))])],1),e._v(" "),a("el-alert",{directives:[{name:"show",rawName:"v-show",value:e.userBox.selectData.length>0,expression:"userBox.selectData.length > 0"}],attrs:{type:"warning","close-text":"清除所选"},on:{close:e.clearAlert}},[a("div",{staticClass:"alert-list",attrs:{slot:"title"},slot:"title"},e._l(e.userBox.selectData,function(t){return a("el-tag",{key:t._id,staticStyle:{"margin-right":"20px"},attrs:{size:"small",closable:"",type:"success"},on:{close:function(a){return e.selectRemove(t)}}},[e._v("\n          "+e._s(t.name)+"\n        ")])}),1)]),e._v(" "),a("my-table",{ref:e.userTable.ref,staticClass:"user-table",attrs:{tableData:e.userTable,pageObj:e.tablePage},on:{pageChange:e.tablePageChange,selectChange:e.selectChange}}),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"})],1)],1)},staticRenderFns:[]};var u=a("VU/8")(l,c,!1,function(e){a("FYG8")},"data-v-d181d342",null);t.default=u.exports}});