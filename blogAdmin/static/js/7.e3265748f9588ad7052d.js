webpackJsonp([7],{mzS8:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a("qGD+"),i=a("W2KW"),s=(a("4/BI"),{data:function(){var t=this;return{articleStatus:"1",tabList:[{name:"已发布",value:"1"},{name:"草稿",value:"0"}],sortObj:{sortBy:null,sortOrders:null},pageObj:{pageSize:10,total:0,currentPage:1},tableData:{ref:"table",dataList:[],columns:[{prop:"title",sortable:"custom",width:180,showTooltip:!0,label:"文章标题"},{prop:"imgId",label:"文章封面",render:function(e,a){return e("img",{attrs:{src:a.row.imgId?t.$baseURL+"/file/down?downId="+a.row.imgId:"https://gw.alipayobjects.com/zos/rmsportal/sfjbOqnsXXJgNCjCzDBL.png"},style:{width:"60px",height:"auto",verticalAlign:"middle",borderRadius:"4px"}})}},{prop:"createUser",label:"文章作者",render:function(t,e){return t("span",e.row.createUser?e.row.createUser.name:"--")}},{prop:"meta.viewTotal",sortable:"custom",label:"浏览量",render:function(t,e){return t("span",e.row.meta.viewTotal||0)}},{prop:"meta.likeTotal",sortable:"custom",label:"点赞数",render:function(t,e){return t("span",e.row.meta.likeTotal||0)}},{prop:"meta.commentTotal",sortable:"custom",label:"评论数",render:function(t,e){return t("span",e.row.meta.commentTotal||0)}},{prop:"tags",width:200,label:"文章标签",render:function(t,e){var a=[],r=e.row.tags;if(r.length>0)for(var i=0;i<r.length;i++)a.push(t("div",{style:{margin:"3px 10px",color:"#fff",borderRadius:"4px",padding:"3px 10px",background:r[i].bgColor}},r[i].name));return t("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flexWrap:"wrap"}},0===a.length?"--":a)}},{prop:"createTime",sortable:!0,label:"创建时间",render:function(t,e){return t("div",e.row.createTime?e.row.createTime.split(" ")[0]:"--")}},{prop:"operate",align:"center",label:"操作",width:300,render:function(e,a){var r="1"===t.articleStatus;return e("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"}},[e("el-button",{props:{type:r?"info":"success",size:"small"},style:{display:t.authList.includes("5e834f2afb69305aa091e825")?"block":"none"},on:{click:function(){t.updateStatus(a)}}},r?"转草稿":"发布"),e("el-button",{props:{type:"warning",size:"small"},style:{display:r&&t.authList.includes("5e99c1ccd1ba729a78b016b8")?"block":"none"},on:{click:function(){t.$router.push({path:"/article/comment",query:{articleId:a.row._id,articleTitle:a.row.title}})}}},"评论"),e("el-button",{props:{type:"primary",size:"small"},style:{display:t.authList.includes("5e834f2afb69305aa091e825")?"block":"none"},on:{click:function(){t.$router.push({path:"/article/edit",query:{articleId:a.row._id,articleTitle:a.row.title}})}}},"编辑"),e("el-button",{props:{type:"danger",size:"small"},style:{display:t.authList.includes("5e834f31fb69305aa091e826")?"block":"none"},on:{click:function(){t.dataDel(a)}}},"删除")])}}]},searchForm:{labelWidth:"70px",ref:"searchRef",inline:!0,marginRight:"30px",formItemList:[{type:"text",prop:"title",width:"160px",label:"文章标题",placeholder:"文章标题"},{type:"select",prop:"tags",width:"160px",label:"文章标签",placeholder:"文章标签",arrList:[]},{type:"date",dateType:"daterange",prop:"createTime",width:"260px",label:"创建时间",change:this.timeChange}],operate:[{name:"查询",handleClick:this.getDataList},{name:"新增",hide:!1,handleClick:this.dataAdd},{name:"重置",type:"transparent",handleClick:this.resetForm}],formModel:{title:"",tags:"",createTime:[]}}}},created:function(){this.searchForm.operate[1].hide=!this.authList.includes("5e834f23fb69305aa091e824"),this.getTagsList()},mounted:function(){this.getDataList()},methods:{getDataList:function(t){var e=this;this.pageObj.currentPage=!0===t?this.pageObj.currentPage:1;var a=this.searchForm.formModel,r=this.sortObj,i=r.sortBy,s=r.sortOrders;this.$api.article.articleList({currentPage:this.pageObj.currentPage,pageSize:this.pageObj.pageSize,title:a.title,tags:a.tags,status:this.articleStatus,createTime:a.createTime?a.createTime.join(","):null,sortBy:i,sortOrders:s}).then(function(t){t.code===e.$constant.reqSuccess?(e.pageObj.total=t.data.count,e.tableData.dataList=t.data.data):e.$message.warning("获取文章列表失败")})},getTagsList:function(){var t=this;this.$api.article.tagList({currentPage:"1",pageSize:"99"}).then(function(e){if(e.code===t.$constant.reqSuccess){var a=e.data.data;a.length>0&&a.forEach(function(t){t.label=t.name,t.value=t._id}),t.searchForm.formItemList[1].arrList=a}else t.$message.warning("获取标签列表失败")})},sortChange:function(t){t.order?this.sortObj={sortBy:t.prop,sortOrders:t.order}:this.sortObj={sortBy:null,sortOrders:null},this.getDataList()},timeChange:function(t){this.searchForm.formModel.createTime=t||null},dataAdd:function(){this.$router.push({path:"/article/articleAdd"})},resetForm:function(){this.$refs.searchRef&&this.$refs.searchRef.$refs.searchRef.resetFields(),this.getDataList()},updateStatus:function(t){var e=this;this.$confirm("此操作将修改文章状态, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$api.article.articleUpdate({id:t.row._id,status:"1"===e.articleStatus?"0":"1"}).then(function(t){t.code===e.$constant.reqSuccess?(e.getDataList(),e.$message.success("文章修改状态成功")):e.$message.warning("文章修改状态失败")})}).catch(function(){})},dataDel:function(t){var e=this;this.$confirm("此操作将永久删除该文章, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$api.article.articleDel(t.row._id).then(function(a){a.code===e.$constant.reqSuccess?(e.getDataList(),e.$message.success("文章删除成功"),e.$api.upload.fileDel(t.row.imgId).then(function(t){})):e.$message.warning("文章删除失败")})}).catch(function(){})},pageChange:function(t){this.pageObj.currentPage=t,this.getDataList(!0)}},components:{MyTable:r.a,MyForm:i.a},computed:{authList:function(){return this.$store.getters.getAuthList}}}),n={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"wrapper"},[a("h2",{staticClass:"content-title"},[t._v("文章列表")]),t._v(" "),a("div",{staticClass:"box-table"},[a("my-form",{ref:t.searchForm.ref,attrs:{formConfig:t.searchForm}}),t._v(" "),a("el-tabs",{on:{"tab-click":t.getDataList},model:{value:t.articleStatus,callback:function(e){t.articleStatus=e},expression:"articleStatus"}},t._l(t.tabList,function(t){return a("el-tab-pane",{key:t.value,attrs:{label:t.name,name:t.value}})}),1),t._v(" "),a("my-table",{attrs:{tableData:t.tableData,pageObj:t.pageObj},on:{sortChange:t.sortChange,pageChange:t.pageChange}})],1)])},staticRenderFns:[]};var o=a("VU/8")(s,n,!1,function(t){a("nLsJ")},"data-v-b04ac318",null);e.default=o.exports},nLsJ:function(t,e){}});