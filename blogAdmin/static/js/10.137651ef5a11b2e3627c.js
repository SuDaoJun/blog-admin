webpackJsonp([10],{GJwN:function(e,t){},b46h:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("qGD+"),i=a("W2KW"),o=a("hx1z"),s=a("4/BI"),n={data:function(){var e=this,t=[{label:"进行中",value:"2"},{label:"已完成",value:"1"},{label:"已废弃",value:"3"}];return{projectStatus:"2",statusArr:t,fileList:[],sortObj:{sortBy:null,sortOrders:null},dialogBox:{boxShow:!1,isEdit:!1,detailItem:{}},pageObj:{pageSize:10,total:0,currentPage:1},searchForm:{labelWidth:"70px",ref:"searchRef",inline:!0,marginRight:"30px",formItemList:[{type:"text",prop:"name",width:"180px",label:"项目名称",placeholder:"请输入项目名称",blur:this.getDataList},{type:"date",dateType:"daterange",prop:"startTime",width:"300px",label:"开始时间",change:this.timeChange}],operate:[{name:"新增",hide:!1,handleClick:this.dataAdd}],formModel:{name:"",startTime:[]}},tableData:{ref:"table",dataList:[],columns:[{prop:"name",sortable:"custom",label:"项目名称"},{prop:"imgId",label:"项目封面",render:function(t,a){return t("img",{attrs:{src:a.row.imgId?e.$baseURL+"/file/down?downId="+a.row.imgId:"https://gw.alipayobjects.com/zos/rmsportal/sfjbOqnsXXJgNCjCzDBL.png"},style:{width:"60px",height:"60px",verticalAlign:"middle",borderRadius:"4px"}})}},{prop:"description",label:"项目描述",showTooltip:!0},{prop:"startTime",sortable:!0,label:"开始时间"},{prop:"endTime",sortable:!0,label:"结束时间"},{prop:"operate",align:"center",label:"操作",hide:!0,render:function(t,a){return t("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"}},[t("el-button",{props:{type:"primary",size:"small"},style:{display:e.authList.includes("5e834f90fb69305aa091e82e")?"block":"none"},on:{click:function(){e.dialogBox.detailItem=a.row,e.editData(a)}}},"编辑"),t("el-button",{props:{type:"danger",size:"small"},style:{display:e.authList.includes("5e834f97fb69305aa091e82f")?"block":"none"},on:{click:function(){e.dataDel(a)}}},"删除")])}}]},projectForm:{labelWidth:"80px",ref:"projectRef",labelPosition:"right",marginRight:"10px",formItemList:[{type:"text",prop:"name",width:"450px",label:"项目名称",placeholder:"请输入项目名称"},{type:"text",prop:"linkUrl",width:"450px",label:"项目地址",placeholder:"请输入项目地址"},{type:"date",prop:"startTime",width:"300px",label:"开始时间",placeholder:"选择日期",pickerOptions:{disabledDate:function(t){var a=e.projectForm.formModel.endTime;if(a)return t.getTime()>new Date(a).getTime()}}},{type:"date",prop:"endTime",width:"300px",label:"结束时间",placeholder:"选择日期",pickerOptions:{disabledDate:function(t){var a=e.projectForm.formModel.startTime;if(a)return t.getTime()<new Date(a).getTime()-864e5}}},{type:"radio",prop:"status",label:"项目状态",arrList:t},{label:"项目封面",slot:"upload"},{type:"textarea",prop:"description",width:"450px",label:"项目描述",placeholder:"请输入项目描述"}],formModel:{name:"",linkUrl:"",startTime:"",endTime:"",status:"2",description:""},rules:{name:[{required:!0,validator:s.a.FormValidate.Form("项目名称").NoEmpty,trigger:"blur"}],linkUrl:[{required:!0,validator:s.a.FormValidate.Form("项目地址").NoEmpty,trigger:"blur"}],startTime:[{required:!0,validator:s.a.FormValidate.Form("项目开始时间").NoEmpty,trigger:"change"}],status:[{required:!0,validator:s.a.FormValidate.Form("项目状态").NoEmpty,trigger:"change"}],description:[{required:!0,validator:s.a.FormValidate.Form("项目描述").NoEmpty,trigger:"blur"}]}}}},created:function(){this.searchForm.operate[0].hide=!this.authList.includes("5e834f88fb69305aa091e82d"),this.tableData.columns[5].hide=!this.authList.includes("5e834f90fb69305aa091e82e")&&!this.authList.includes("5e834f97fb69305aa091e82f")},mounted:function(){this.getDataList()},methods:{getDataList:function(e){var t=this,a=this.pageObj,r=this.projectStatus;a.currentPage=!0===e?a.currentPage:1;var i=this.searchForm.formModel,o=this.sortObj,s=o.sortBy,n=o.sortOrders;this.$api.project.projectList({currentPage:a.currentPage,pageSize:a.pageSize,name:i.name,status:r,startTime:i.startTime?i.startTime.join(","):null,sortBy:s,sortOrders:n}).then(function(e){e.code===t.$constant.reqSuccess?(t.pageObj.total=e.data.count,t.tableData.dataList=e.data.data):t.$message.warning("获取项目列表失败")})},sortChange:function(e){e.order?this.sortObj={sortBy:e.prop,sortOrders:e.order}:this.sortObj={sortBy:null,sortOrders:null},this.getDataList()},timeChange:function(e){this.searchForm.formModel.startTime=e||null,this.getDataList()},beforeUpload:function(e){this.fileList=[e]},beforeRemove:function(e){this.fileList=[]},dataAdd:function(){this.$refs.projectRef&&this.$refs.projectRef.$refs.projectRef.resetFields(),this.fileList=[],this.dialogBox.isEdit=!1,this.dialogBox.boxShow=!0},editData:function(e){var t=this;e.row.imgId&&(this.fileList=[{name:"",url:this.$baseURL+"/file/down?downId="+e.row.imgId,sourceId:e.row.imgId}]),this.dialogBox.isEdit=!0,this.dialogBox.boxShow=!0,this.$nextTick(function(){t.$refs.projectRef&&t.$refs.projectRef.$refs.projectRef.resetFields(),t.projectForm.formModel={name:e.row.name,linkUrl:e.row.linkUrl,startTime:e.row.startTime,endTime:e.row.endTime,status:e.row.status,description:e.row.description}})},confirSubmit:function(){var e=this;this.$refs.projectRef.$refs.projectRef.validate(function(t){var a=e.dialogBox,r=e.fileList,i=e.projectForm.formModel;t?a.isEdit?e.$api.project.projectUpdate({id:a.detailItem._id,name:i.name,linkUrl:i.linkUrl,status:i.status,startTime:i.startTime,endTime:i.endTime,imgId:r.length>0?r[0].sourceId:null,description:i.description}).then(function(t){var a=t.code;a===e.$constant.reqSuccess?(e.dialogBox.boxShow=!1,e.getDataList(),e.$message.success("项目信息更新成功")):a===e.$constant.dataAlready?(e.$message.warning("项目名称已存在"),i.name=""):e.$message.warning("项目信息更新失败")}):e.$api.project.projectAdd({name:i.name,linkUrl:i.linkUrl,status:i.status,startTime:i.startTime,endTime:i.endTime,imgId:r.length>0?r[0].sourceId:null,description:i.description}).then(function(t){var a=t.code;a===e.$constant.reqSuccess?(e.dialogBox.boxShow=!1,e.getDataList(),e.$message.success("项目信息添加成功")):a===e.$constant.dataAlready?(e.$message.warning("项目名称已存在"),i.name=""):e.$message.warning("项目信息添加失败")}):e.$message.warning("信息校验失败")})},dataDel:function(e){var t=this;this.$confirm("此操作将删除该项目, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$api.project.projectDel(e.row._id).then(function(e){e.code===t.$constant.reqSuccess?(t.getDataList(),t.$message.success("项目删除成功")):t.$message.warning("项目删除失败")})}).catch(function(){})},pageChange:function(e){this.pageObj.currentPage=e,this.getDataList(!0)}},components:{MyTable:r.a,MyForm:i.a,UploadFile:o.a},computed:{authList:function(){return this.$store.getters.getAuthList}}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"wrapper"},[a("h2",{staticClass:"content-title"},[e._v("项目列表")]),e._v(" "),a("div",{staticClass:"box-table"},[a("my-form",{ref:e.searchForm.ref,attrs:{formConfig:e.searchForm}}),e._v(" "),a("el-tabs",{on:{"tab-click":e.getDataList},model:{value:e.projectStatus,callback:function(t){e.projectStatus=t},expression:"projectStatus"}},e._l(e.statusArr,function(e){return a("el-tab-pane",{key:e.value,attrs:{label:e.label,name:e.value}})}),1),e._v(" "),a("my-table",{attrs:{tableData:e.tableData,pageObj:e.pageObj},on:{sortChange:e.sortChange,pageChange:e.pageChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:e.dialogBox.isEdit?"编辑项目":"新增项目",visible:e.dialogBox.boxShow,width:"640px"},on:{"update:visible":function(t){return e.$set(e.dialogBox,"boxShow",t)}}},[a("my-form",{ref:e.projectForm.ref,attrs:{formConfig:e.projectForm}},[a("div",{attrs:{slot:"upload"},slot:"upload"},[a("upload-file",{attrs:{fileList:e.fileList,listType:"picture-card"},on:{uploadEvent:e.beforeUpload,removeEvent:e.beforeRemove}})],1)]),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogBox.boxShow=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.confirSubmit}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var d=a("VU/8")(n,l,!1,function(e){a("GJwN")},"data-v-5c031b07",null);t.default=d.exports}});