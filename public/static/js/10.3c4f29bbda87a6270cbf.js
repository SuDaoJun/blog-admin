webpackJsonp([10],{Cw75:function(e,t){},L0Tv:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("mvHQ"),a=i.n(n),o=i("qGD+"),s=i("W2KW"),r=i("4/BI"),d={data:function(){return{filterText:"",treeData:[],treeMenu:[],defaultKey:[],dialogBox:{boxShow:!1,boxTitle:"",operType:"",detailItem:{}},menuForm:{labelWidth:"80px",ref:"menuRef",labelPosition:"right",marginRight:"10px",formItemList:[{type:"text",prop:"title",width:"350px",label:"标题",placeholder:"请输入标题"},{type:"treeSelect",label:"上级菜单",props:{value:"_id",label:"title",children:"children"},value:"",disabled:!1,treeData:[],getValue:this.getValue},{type:"text",prop:"description",width:"350px",label:"描述",placeholder:"请输入描述"}],formModel:{title:"",description:""},rules:{title:[{required:!0,validator:r.a.FormValidate.Form("菜单标题").NoEmpty,trigger:"blur"}]}}}},created:function(){},mounted:function(){this.getTreeList()},methods:{getTreeList:function(){var e=this;this.$api.menu.menuTree().then(function(t){if(t.code===e.$constant.reqSuccess){var i=t.data;e.treeMenu=JSON.parse(a()(t.data)),i.length>0&&(e.functionChildList(i),e.defaultKey.push(i[0]._id)),e.treeData=i,e.menuForm.formItemList[1].treeData=e.treeMenu}else e.$message.warning("获取菜单列表失败")})},functionChildList:function(e){var t=this;e.forEach(function(e){e.functionList&&e.functionList.length>0?e.children=e.functionList:e.children&&e.children.length>0&&t.functionChildList(e.children)})},dataAdd:function(e){this.$refs.menuRef&&this.$refs.menuRef.$refs.menuRef.resetFields(),"menu"===e?(this.menuForm.formItemList[1].value="",this.menuForm.formItemList[1].disabled=!1,this.dialogBox.operType="addMenu",this.dialogBox.boxTitle="新增菜单"):(this.menuForm.formItemList[1].value=e._id,this.menuForm.formItemList[1].disabled=!0,this.dialogBox.operType="addFunction",this.dialogBox.boxTitle="新增功能"),this.dialogBox.boxShow=!0},filterNode:function(e,t){return!e||-1!==t.title.indexOf(e)},editData:function(e){var t=this;e.menuId?(this.dialogBox.boxShow=!0,this.$nextTick(function(){t.$refs.menuRef&&t.$refs.menuRef.$refs.menuRef.resetFields(),t.menuForm.formItemList[1].value=e.menuId,t.menuForm.formItemList[1].disabled=!1,t.dialogBox.detailItem=e,t.dialogBox.operType="editFunction",t.dialogBox.boxTitle="编辑功能",t.menuForm.formModel={title:e.title,description:e.description}})):(this.dialogBox.boxShow=!0,this.$nextTick(function(){t.$refs.menuRef&&t.$refs.menuRef.$refs.menuRef.resetFields(),t.menuForm.formItemList[1].value=e.parentId,t.menuForm.formItemList[1].disabled=!1,t.dialogBox.detailItem=e,t.dialogBox.operType="editMenu",t.dialogBox.boxTitle="编辑菜单",t.menuForm.formModel={title:e.title,description:e.description}}))},confirSubmit:function(){var e=this;this.$refs.menuRef.$refs.menuRef.validate(function(t){var i=e.dialogBox,n=e.menuForm.formModel,a=e.menuForm.formItemList[1].value;if(!a)return e.$message.warning("上级菜单不能为空");if(t)if(e.defaultKey=[],e.defaultKey.push(a),"addMenu"===i.operType)e.$api.menu.menuAdd({title:n.title,parentId:a,description:n.description}).then(function(t){var i=t.code;i===e.$constant.reqSuccess?(e.dialogBox.boxShow=!1,e.getTreeList()):i===e.$constant.dataAlready?(e.$message.warning("菜单标题已存在"),n.title=""):e.$message.warning("菜单标题添加失败")});else if("addFunction"===i.operType)e.$api.menu.functionAdd({title:n.title,menuId:a,description:n.description}).then(function(t){var i=t.code;i===e.$constant.reqSuccess?(e.dialogBox.boxShow=!1,e.getTreeList()):i===e.$constant.dataAlready?(e.$message.warning("功能标题已存在"),n.title=""):e.$message.warning("功能标题添加失败")});else if("editMenu"===i.operType){if(i.detailItem._id===a)return e.$message.warning("上级菜单不可选本身");e.$api.menu.menuUpdate({id:i.detailItem._id,title:n.title,parentId:a,description:n.description}).then(function(t){var i=t.code;i===e.$constant.reqSuccess?(e.dialogBox.boxShow=!1,e.getTreeList()):i===e.$constant.statusFail?e.$message.warning("上级菜单不可选本身"):i===e.$constant.dataAlready?(e.$message.warning("菜单标题已存在"),n.title=""):e.$message.warning("菜单标题更新失败")})}else"editFunction"===i.operType&&e.$api.menu.functionUpdate({id:i.detailItem._id,title:n.title,menuId:a,description:n.description}).then(function(t){var i=t.code;i===e.$constant.reqSuccess?(e.dialogBox.boxShow=!1,e.getTreeList()):i===e.$constant.dataAlready?(e.$message.warning("功能标题已存在"),n.title=""):e.$message.warning("功能标题更新失败")});else e.$message.warning("信息校验失败")})},dataDel:function(e){var t=this;if(e.function&&e.function.length>0)return this.$message.warning("该菜单存在功能列表，请先删除功能");var i=e.menuId?"功能":"菜单";this.$confirm("此操作将删除该"+i+", 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.defaultKey=[],t.defaultKey.push(e._id),"菜单"===i?t.$api.menu.menuDel(e._id).then(function(e){var n=e.code;n===t.$constant.reqSuccess?t.getTreeList():n===t.$constant.dataAlready?t.$message.warning("该菜单存在功能列表，请先删除功能"):t.$message.warning(i+"删除失败")}):t.$api.menu.functionDel(e._id).then(function(e){e.code===t.$constant.reqSuccess?t.getTreeList():t.$message.warning(i+"删除失败")})}).catch(function(){})},getValue:function(e){this.menuForm.formItemList[1].value=e}},components:{MyTable:o.a,MyForm:s.a},watch:{filterText:function(e){this.$refs.tree.filter(e)}},computed:{authList:function(){return this.$store.getters.getAuthList}}},l={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"wrapper"},[i("h2",{staticClass:"content-title"},[e._v("菜单列表")]),e._v(" "),i("div",{staticClass:"box-table"},[i("div",{staticClass:"list-filter"},[i("el-input",{staticClass:"filter-text",attrs:{placeholder:"输入关键字进行过滤",clearable:""},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),e._v(" "),e.authList.includes("5e99c25ad1ba729a78b016bc")?i("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.dataAdd("menu")}}},[e._v("新增菜单")]):e._e()],1),e._v(" "),e._m(0),e._v(" "),i("div",{staticClass:"list-tree"},[i("el-tree",{ref:"tree",attrs:{"default-expanded-keys":e.defaultKey,"highlight-current":"","node-key":"_id",data:e.treeData,"filter-node-method":e.filterNode},scopedSlots:e._u([{key:"default",fn:function(t){t.node;var n=t.data;return i("div",{staticClass:"tree-node"},[i("div",{staticClass:"node-title"},[i("i",{class:n.menuId?"el-icon-setting":"mio-icon-icon_caidan iconfont"}),e._v(" "),i("span",[e._v(e._s(n.title))])]),e._v(" "),i("div",{staticClass:"node-box"},[e._v("\n            "+e._s(n.menuId?"功能":"菜单")+"\n          ")]),e._v(" "),i("div",{staticClass:"node-box"},[e.authList.includes("5e99c280d1ba729a78b016bd")&&"0"!=n.parentId?i("div",{staticClass:"box-btn",on:{click:function(t){return t.stopPropagation(),e.editData(n)}}},[e._v("编辑")]):e._e(),e._v(" "),e.authList.includes("5e99c287d1ba729a78b016be")&&"0"!=n.parentId?i("div",{staticClass:"box-btn btn-del",on:{click:function(t){return t.stopPropagation(),e.dataDel(n)}}},[e._v("删除")]):e._e(),e._v(" "),(!n.children&&!n.menuId||(n.functionList&&n.functionList.length)>0)&&e.authList.includes("5e99c25ad1ba729a78b016bc")?i("div",{staticClass:"box-btn btn-add",on:{click:function(t){return t.stopPropagation(),e.dataAdd(n)}}},[e._v("新增功能")]):e._e()])])}}])})],1)]),e._v(" "),i("el-dialog",{attrs:{title:e.dialogBox.boxTitle,visible:e.dialogBox.boxShow,width:"550px"},on:{"update:visible":function(t){return e.$set(e.dialogBox,"boxShow",t)}},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.confirSubmit(t)}}},[i("my-form",{ref:e.menuForm.ref,attrs:{formConfig:e.menuForm}}),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogBox.boxShow=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.confirSubmit}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"list-header"},[t("div",{staticClass:"header-title"},[this._v("名称")]),this._v(" "),t("div",{staticClass:"header-title"},[this._v("类别")]),this._v(" "),t("div",{staticClass:"header-title"},[this._v("操作")])])}]};var u=i("VU/8")(d,l,!1,function(e){i("Cw75")},"data-v-154156d3",null);t.default=u.exports}});