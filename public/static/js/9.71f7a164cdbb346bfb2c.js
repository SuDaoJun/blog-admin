webpackJsonp([9],{W2Q3:function(e,o,r){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var a=r("mvHQ"),t=r.n(a),i=r("W2KW"),s=r("4/BI"),n=r("oAV5"),l={data:function(){var e=this;return{showBox:"login",rememberBool:!1,emailCode:{emailTxt:"获取验证码",emailTime:60,emailStatus:!0},codeImg:this.$baseURL+"/user/getCode?t="+(new Date).getTime(),loginForm:{ref:"loginRef",marginBottom:"25px",formItemList:[{type:"text",prop:"name",prefix:"mio-icon-yonghu",placeholder:"用户名或邮箱"},{type:"password",prop:"password",prefix:"mio-icon-mima",placeholder:"密码"},{type:"code",prop:"code",width:"280px",prefix:"mio-icon-yanzhengma",placeholder:"验证码",codeSlot:"randomCode"}],formModel:{name:"",password:"",code:""},rules:{name:[{required:!0,validator:s.a.FormValidate.Form("用户名或邮箱").NoEmpty,trigger:"blur"}],password:[{required:!0,validator:s.a.FormValidate.Form("密码").Password,trigger:"blur"}],code:[{required:!0,validator:s.a.FormValidate.Form("验证码").FourCode,trigger:"blur"}]}},registerForm:{ref:"registerRef",marginBottom:"25px",formItemList:[{type:"text",prop:"email",prefix:"mio-icon-tubiao209",placeholder:"邮箱"},{type:"code",prop:"emailCode",width:"280px",prefix:"el-icon-right",placeholder:"邮箱验证码",codeSlot:"emailCode"},{type:"text",prop:"name",prefix:"mio-icon-yonghu",placeholder:"用户名"},{type:"text",prop:"phone",prefix:"el-icon-mobile-phone",placeholder:"手机号码（选填）"},{type:"password",prop:"password",prefix:"mio-icon-mima",placeholder:"密码"},{type:"password",prop:"confirPwd",prefix:"mio-icon-mima",placeholder:"确认密码"},{type:"code",prop:"code",width:"280px",prefix:"mio-icon-yanzhengma",placeholder:"验证码",codeSlot:"randomCodes"}],formModel:{name:"",email:"",emailCode:"",phone:"",password:"",confirPwd:"",code:""},rules:{name:[{required:!0,validator:s.a.FormValidate.Form("用户名").NoEmpty,trigger:"blur"}],email:[{required:!0,validator:s.a.FormValidate.Form("邮箱").Email,trigger:"blur"}],emailCode:[{required:!0,validator:s.a.FormValidate.Form("邮箱验证码").FourCode,trigger:"blur"}],password:[{required:!0,validator:s.a.FormValidate.Form("密码").Password,trigger:"blur"}],confirPwd:[{required:!0,validator:function(o,r,a){""===r||void 0===r?a(new Error("请输入确认密码")):r.length<6||r.length>16?a(new Error("确认密码字符长度为6-16个字符")):r!=e.registerForm.formModel.password?a(new Error("确认密码和密码不一致")):a()},trigger:"blur"}],code:[{required:!0,validator:s.a.FormValidate.Form("验证码").FourCode,trigger:"blur"}]}},forgetForm:{ref:"forgetRef",marginBottom:"25px",formItemList:[{type:"text",prop:"email",prefix:"mio-icon-tubiao209",placeholder:"邮箱"},{type:"code",prop:"emailCode",width:"280px",prefix:"el-icon-right",placeholder:"邮箱验证码",codeSlot:"emailCode"},{type:"password",prop:"password",prefix:"mio-icon-mima",placeholder:"密码"},{type:"password",prop:"confirPwd",prefix:"mio-icon-mima",placeholder:"确认密码"},{type:"code",prop:"code",width:"280px",prefix:"mio-icon-yanzhengma",placeholder:"验证码",codeSlot:"randomCodes"}],formModel:{email:"",emailCode:"",password:"",confirPwd:"",code:""},rules:{email:[{required:!0,validator:s.a.FormValidate.Form("邮箱").Email,trigger:"blur"}],emailCode:[{required:!0,validator:s.a.FormValidate.Form("邮箱验证码").FourCode,trigger:"blur"}],password:[{required:!0,validator:s.a.FormValidate.Form("密码").Password,trigger:"blur"}],confirPwd:[{required:!0,validator:function(o,r,a){""===r||void 0===r?a(new Error("请输入确认密码")):r.length<6||r.length>16?a(new Error("确认密码字符长度为6-16个字符")):r!=e.forgetForm.formModel.password?a(new Error("确认密码和密码不一致")):a()},trigger:"blur"}],code:[{required:!0,validator:s.a.FormValidate.Form("验证码").FourCode,trigger:"blur"}]}}}},created:function(){},mounted:function(){this.storgeInit()},methods:{storgeInit:function(){if(sessionStorage.getItem("token")&&sessionStorage.removeItem("token"),n.f.getItem("remember")){this.loginForm.formModel.name=n.f.getItem("name")?n.f.getItem("name"):"";var e=n.f.getItem("pwd"),o="";if(e){var r=e.slice(1,4)+e.slice(5,7)+e.slice(8,e.length-1);o=this.$Base64.decode(r)}this.loginForm.formModel.password=o,this.rememberBool=!0}},codeChange:function(){this.codeImg=this.$baseURL+"/user/getCode?t="+(new Date).getTime(),this.loginForm.formModel.code="",this.registerForm.formModel.code="",this.forgetForm.formModel.code=""},goRegister:function(){this.$refs.registerRef&&this.$refs.registerRef.$refs.registerRef.resetFields(),this.codeChange(),this.showBox="register"},goForget:function(){this.$refs.forgetRef&&this.$refs.forgetRef.$refs.forgetRef.resetFields(),this.codeChange(),this.showBox="forget"},backLogin:function(){this.$refs.loginRef&&this.$refs.loginRef.$refs.loginRef.resetFields(),this.storgeInit(),this.codeChange(),this.showBox="login"},getEmailCode:function(){var e=this,o=this.emailCode,r="register"===this.showBox?this.registerForm.formModel.email:this.forgetForm.formModel.email;if(s.a.emailReg.test(r))if(o.emailStatus){var a=setInterval(function(){o.emailTime--,o.emailTxt="重新获取"+o.emailTime+"s",o.emailStatus=!1,o.emailTime<=0&&(clearInterval(a),o.emailTime=60,o.emailTxt="获取验证码",o.emailStatus=!0)},1e3);this.$api.user.sendEmail({email:r,type:"register"===this.showBox?"add":"update"}).then(function(r){var t=r.code;t===e.$constant.reqSuccess?e.$message.success("邮件发送成功"):t===e.$constant.dataAlready?(e.$message.warning("该邮箱账号已存在，请直接登录"),clearInterval(a),o.emailTime=60,o.emailTxt="获取验证码",o.emailStatus=!0):t===e.$constant.dataNot?(e.$message.warning("该邮箱账号不存在"),clearInterval(a),o.emailTime=60,o.emailTxt="获取验证码",o.emailStatus=!0):e.$message.warning("邮件发送失败")})}else this.$message.warning("请"+o.emailTime+"s后再获取验证码");else this.$message.warning("请输入正确的邮箱账号")},handleLogin:function(){var e=this,o=this.loginForm.formModel;this.$refs.loginRef.$refs.loginRef.validate(function(r){r?e.$api.user.login({name:o.name,password:o.password,randomCode:o.code}).then(function(r){var a=r.code;if(a===e.$constant.reqSuccess){if(!0===e.rememberBool){var i=e.$Base64.encode(o.password),s="S"+i.slice(0,3)+"0"+i.slice(3,5)+"7"+i.slice(5)+"j";n.f.setItem("remember","remember",15),n.f.setItem("name",o.name,15),n.f.setItem("pwd",s,15)}else n.f.getItem("remember")&&(localStorage.removeItem("remember"),localStorage.removeItem("name"),localStorage.removeItem("pwd"));sessionStorage.setItem("token","Bearer "+r.data.token),sessionStorage.setItem("userInfo",t()(r.data.user));var l=e.$route.query.redirect?e.$route.query.redirect:"";e.$router.push({path:l||"/"})}else a===e.$constant.randomFail?(e.$message.warning("随机验证码错误或超过有效期10分钟"),e.codeChange()):a===e.$constant.dataFail?(e.$message.warning("邮箱或用户名不存在"),e.loginForm.formModel.name=""):a===e.$constant.statusFail?(e.$message.warning("该用户处于禁用状态，请联系管理员启用该账号"),e.codeChange()):a===e.$constant.pwdFail?(e.$message.warning("密码错误"),e.loginForm.formModel.password=""):e.$message.warning("登录失败")}):e.$message.warning("信息校验失败")})},handleRegister:function(){var e=this,o=this.registerForm.formModel;this.$refs.registerRef.$refs.registerRef.validate(function(r){r?e.$api.user.register({email:o.email,emailCode:o.emailCode,name:o.name,phone:o.phone,password:o.password,randomCode:o.code}).then(function(r){var a=r.code;a===e.$constant.reqSuccess?(e.$message.success("账号注册成功，请登录"),e.backLogin()):a===e.$constant.randomFail?(e.$message.warning("随机验证码错误或超过有效期10分钟"),e.codeChange()):a===e.$constant.dataAlready?(e.$message.warning("该用户名已存在"),o.name=""):a===e.$constant.codeFail?(e.$message.warning("邮箱验证码错误"),o.emailCode=""):a===e.$constant.timeOver?(e.$message.warning("邮箱验证码有效时间为10分钟"),o.emailCode=""):e.$message.warning("账号注册失败")}):e.$message.warning("信息校验失败")})},handleForget:function(){var e=this,o=this.forgetForm.formModel;this.$refs.forgetRef.$refs.forgetRef.validate(function(r){r?e.$api.user.resetPwd({email:o.email,emailCode:o.emailCode,password:o.password,randomCode:o.code}).then(function(r){var a=r.code;a===e.$constant.reqSuccess?(e.$message.success("密码重置成功，请登录"),e.backLogin()):a===e.$constant.randomFail?(e.$message.warning("随机验证码错误或超过有效期10分钟"),e.codeChange()):a===e.$constant.dataFail?(e.$message.warning("邮箱不存在"),o.email=""):a===e.$constant.codeFail?(e.$message.warning("邮箱验证码错误"),o.emailCode=""):a===e.$constant.timeOver?(e.$message.warning("邮箱验证码有效时间为10分钟"),o.emailCode=""):e.$message.warning("密码重置失败")}):e.$message.warning("信息校验失败")})}},watch:{},components:{MyForm:i.a},computed:{}},m={render:function(){var e=this,o=e.$createElement,r=e._self._c||o;return r("div",{staticClass:"wrapper"},[r("vue-particles",{staticClass:"index-particles",attrs:{color:"#fff",particleOpacity:.5,particlesNumber:30}}),e._v(" "),r("div",{staticClass:"index-box"},[r("div",{directives:[{name:"show",rawName:"v-show",value:"login"===e.showBox,expression:'showBox === "login"'}],staticClass:"box-login animated  fadeInUp",on:{keyup:function(o){return!o.type.indexOf("key")&&e._k(o.keyCode,"enter",13,o.key,"Enter")?null:e.handleLogin(o)}}},[r("my-form",{ref:e.loginForm.ref,attrs:{formConfig:e.loginForm}},[r("div",{staticClass:"code-show",attrs:{slot:"randomCode"},slot:"randomCode"},[r("el-image",{attrs:{src:e.codeImg,alt:"验证码"},nativeOn:{click:function(o){return e.codeChange(o)}}})],1)]),e._v(" "),r("div",{staticClass:"login-operate"},[r("div",{staticClass:"operate-remeber"},[r("el-checkbox",{model:{value:e.rememberBool,callback:function(o){e.rememberBool=o},expression:"rememberBool"}},[e._v("记住我")])],1),e._v(" "),r("div",{staticClass:"operate-forget",on:{click:e.goForget}},[e._v("\n          忘记密码？\n        ")])]),e._v(" "),r("div",{staticClass:"login-btn",on:{click:e.handleLogin}},[e._v("登录")]),e._v(" "),r("div",{staticClass:"register-btn",on:{click:e.goRegister}},[e._v("注册")])],1),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:"register"===e.showBox,expression:'showBox === "register"'}],staticClass:"box-login animated  fadeInUp",on:{keyup:function(o){return!o.type.indexOf("key")&&e._k(o.keyCode,"enter",13,o.key,"Enter")?null:e.handleRegister(o)}}},[r("my-form",{ref:e.registerForm.ref,attrs:{formConfig:e.registerForm}},[r("div",{class:e.emailCode.emailStatus?"email-code":"email-code email-ban",attrs:{slot:"emailCode"},on:{click:e.getEmailCode},slot:"emailCode"},[e._v("\n          "+e._s(e.emailCode.emailTxt)+"\n        ")]),e._v(" "),r("div",{staticClass:"code-show",attrs:{slot:"randomCodes"},slot:"randomCodes"},[r("el-image",{attrs:{src:e.codeImg,alt:"验证码"},nativeOn:{click:function(o){return e.codeChange(o)}}})],1)]),e._v(" "),r("div",{staticClass:"login-btn",on:{click:e.handleRegister}},[e._v("注册")]),e._v(" "),r("div",{staticClass:"register-btn",on:{click:e.backLogin}},[e._v("返回")])],1),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:"forget"===e.showBox,expression:'showBox === "forget"'}],staticClass:"box-login animated  fadeInUp",on:{keyup:function(o){return!o.type.indexOf("key")&&e._k(o.keyCode,"enter",13,o.key,"Enter")?null:e.handleForget(o)}}},[r("my-form",{ref:e.forgetForm.ref,attrs:{formConfig:e.forgetForm}},[r("div",{class:e.emailCode.emailStatus?"email-code":"email-code email-ban",attrs:{slot:"emailCode"},on:{click:e.getEmailCode},slot:"emailCode"},[e._v("\n          "+e._s(e.emailCode.emailTxt)+"\n        ")]),e._v(" "),r("div",{staticClass:"code-show",attrs:{slot:"randomCodes"},slot:"randomCodes"},[r("el-image",{attrs:{src:e.codeImg,alt:"验证码"},nativeOn:{click:function(o){return e.codeChange(o)}}})],1)]),e._v(" "),r("div",{staticClass:"login-btn",on:{click:e.handleForget}},[e._v("提交")]),e._v(" "),r("div",{staticClass:"register-btn",on:{click:e.backLogin}},[e._v("返回")])],1)])],1)},staticRenderFns:[]};var d=r("VU/8")(l,m,!1,function(e){r("xBS4")},"data-v-1b2d92e7",null);o.default=d.exports},xBS4:function(e,o){}});