webpackJsonp([14],{LRAB:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("qGD+"),i=a("W2KW"),s=a("YlU0"),o=(a("4/BI"),{data:function(){var t=this;return{baseURL:this.$baseURL,articleId:"",articleTitle:"",sortObj:{sortBy:null,sortOrders:null},dialogBox:{boxShow:!1,index:0,detailItem:{}},pageObj:{pageSize:10,total:0,currentPage:1},tableData:{ref:"table",dataList:[],columns:[{prop:"createUser",label:"评论用户",render:function(t,e){return t("span",e.row.createUser?e.row.createUser.name:"--")}},{prop:"content",showTooltip:!0,label:"评论内容"},{prop:"replyCommentList",label:"评论回复",render:function(e,a){var n=a.row.replyCommentList.length;return e("div",{style:{color:"#409EFF",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},on:{click:function(){t.dialogBox.index=a.index,t.dialogBox.detailItem=a.row,t.dialogBox.boxShow=!0}}},[e("i",{class:"el-icon-chat-dot-round",style:{fontSize:"16px",marginRight:"8px"}},""),e("span",n)])}},{prop:"createTime",sortable:!0,label:"创建时间"},{prop:"status",label:"评论状态",render:function(e,a){var n=a.row.status;return e("el-switch",{props:{value:"1"==n,activeColor:"#13ce66",activeText:"1"==n?"启用":"禁用"},on:{change:function(){var e="1"==n?"禁用":"启用";t.authList.includes("5e834f77fb69305aa091e82b")?t.$confirm("此操作将"+e+"评论, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$api.article.commentUpdate({commentId:a.row._id,status:"1"==n?"0":"1"}).then(function(e){e.code===t.$constant.reqSuccess?a.row.status=e.data.status:t.$message.warning("评论状态修改失败")})}).catch(function(){}):t.$message.warning("暂无权限修改状态")}}},"")}},{prop:"operate",align:"center",width:220,label:"操作",render:function(e,a){a.row.status;return e("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"}},[e("el-button",{props:{type:"primary",size:"small"},style:{display:t.authList.includes("5e834f77fb69305aa091e82b")?"block":"none"},on:{click:function(){t.editData(a)}}},"编辑"),e("el-button",{props:{type:"danger",size:"small"},style:{display:t.authList.includes("5e834f61fb69305aa091e829")?"block":"none"},on:{click:function(){t.dataDel(a)}}},"删除"),e("el-button",{props:{type:a.row.isTop?"warning":"info",size:"small"},style:{display:t.authList.includes("5e834f77fb69305aa091e82b")?"block":"none"},on:{click:function(){t.commentTop(a)}}},"置顶")])}}]},searchForm:{labelWidth:"70px",ref:"searchRef",inline:!0,marginRight:"30px",formItemList:[{type:"select",prop:"status",width:"180px",label:"评论状态",arrList:[{label:"待审核",value:"0"},{label:"正常",value:"1"}],change:this.getDataList},{type:"date",dateType:"daterange",prop:"createTime",width:"300px",label:"创建时间",change:this.timeChange}],operate:[{name:"新增",hide:!1,handleClick:this.dataAdd}],formModel:{status:"",createTime:[]}}}},created:function(){this.searchForm.operate[0].hide=!this.authList.includes("5e834f6ffb69305aa091e82a")},mounted:function(){this.$route.query.articleId&&(this.articleId=this.$route.query.articleId,this.articleTitle=this.$route.query.articleTitle,this.getDataList())},methods:{getDataList:function(t){var e=this;this.pageObj.currentPage=!0===t?this.pageObj.currentPage:1;var a=this.searchForm.formModel,n=this.sortObj,i=n.sortBy,s=n.sortOrders;this.$api.article.commentList({currentPage:this.pageObj.currentPage,pageSize:this.pageObj.pageSize,articleId:this.articleId,status:a.status,createTime:a.createTime?a.createTime.join(","):null,sortBy:i,sortOrders:s}).then(function(t){t.code===e.$constant.reqSuccess?(e.pageObj.total=t.data.count,e.tableData.dataList=t.data.data):e.$message.warning("获取评论列表失败")})},sortChange:function(t){t.order?this.sortObj={sortBy:t.prop,sortOrders:t.order}:this.sortObj={sortBy:null,sortOrders:null},this.getDataList()},timeChange:function(t){this.searchForm.formModel.createTime=t||null,this.getDataList()},dataAdd:function(){var t=this;this.$prompt("请输入评论内容","新增评论",{confirmButtonText:"确定",cancelButtonText:"取消",inputType:"textarea",inputPlaceholder:"评论内容",inputValidator:function(t){if(null===t||""===t)return!1},inputErrorMessage:"评论内容不为空"}).then(function(e){var a=e.value;t.$api.article.commentAdd({articleId:t.articleId,content:a,status:"1"}).then(function(e){e.code===t.$constant.reqSuccess?t.getDataList():t.$message.warning("新增评论失败")})}).catch(function(){})},replyCommentAdd:function(){var t=this,e=this.dialogBox,a=e.detailItem,n=e.index;this.$prompt("回复 @"+a.createUser.name+"：","新增回复评论",{confirmButtonText:"确定",cancelButtonText:"取消",inputType:"textarea",inputPlaceholder:"回复评论",inputValidator:function(t){if(null===t||""===t)return!1},inputErrorMessage:"评论内容不为空"}).then(function(e){var i=e.value,s=a.createUser._id;t.$api.article.replyCommentAdd({commentId:a._id,toUser:s,content:i}).then(function(e){e.code===t.$constant.reqSuccess?(t.dialogBox.detailItem=e.data,t.tableData.dataList[n]=e.data,t.$set(t.tableData.dataList,n,t.tableData.dataList[n])):t.$message.warning("新增评论失败")})}).catch(function(){})},replyComment:function(t){var e=this,a=this.dialogBox.index;this.$prompt("回复 @"+t.replyUser.name+"：","新增回复评论",{confirmButtonText:"确定",cancelButtonText:"取消",inputType:"textarea",inputPlaceholder:"回复评论",inputValidator:function(t){if(null===t||""===t)return!1},inputErrorMessage:"评论内容不为空"}).then(function(n){var i=n.value;e.$api.article.replyCommentAdd({commentId:t.commentId,toUser:t.replyUser._id,content:i}).then(function(t){t.code===e.$constant.reqSuccess?(e.dialogBox.detailItem=t.data,e.tableData.dataList[a]=t.data,e.$set(e.tableData.dataList,a,e.tableData.dataList[a])):e.$message.warning("新增评论失败")})}).catch(function(){})},editData:function(t){var e=this;this.$prompt("请输入评论内容","编辑评论",{confirmButtonText:"确定",cancelButtonText:"取消",inputType:"textarea",inputPlaceholder:"评论内容",inputValue:t.row.content,inputValidator:function(t){if(null===t||""===t)return!1},inputErrorMessage:"评论内容不为空"}).then(function(a){var n=a.value;e.$api.article.commentUpdate({commentId:t.row._id,content:n}).then(function(t){t.code===e.$constant.reqSuccess?e.getDataList():e.$message.warning("编辑评论失败")})}).catch(function(){})},replyCommentEdit:function(t){var e=this;this.$prompt("请输入评论内容","编辑回复评论",{confirmButtonText:"确定",cancelButtonText:"取消",inputType:"textarea",inputPlaceholder:"评论内容",inputValue:t.content,inputValidator:function(t){if(null===t||""===t)return!1},inputErrorMessage:"评论内容不为空"}).then(function(a){var n=a.value;e.$api.article.replyCommentUpdate({replayId:t._id,content:n}).then(function(a){a.code===e.$constant.reqSuccess?t.content=n:e.$message.warning("编辑回复评论失败")})}).catch(function(){})},commentTop:function(t){var e=this,a=t.row.isTop,n=a?"是否确定取消该评论置顶？":"是否确定置顶该评论？";this.$confirm(n,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$api.article.commentTop({commentId:t.row._id,isTop:!a}).then(function(t){t.code===e.$constant.reqSuccess?(e.getDataList(),e.$message.success("评论置顶状态修改成功")):e.$message.warning("评论置顶状态修改失败")})}).catch(function(){})},replyCommentStatus:function(t){var e=this,a=t.status,n=a?"是否确定禁用该回复评论？":"是否确定启用该回复评论？";this.$confirm(n,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$api.article.replyCommentUpdate({replayId:t._id,status:"1"===a?"0":"1"}).then(function(a){a.code===e.$constant.reqSuccess?t.status=a.data.status:e.$message.warning("评论状态修改失败")})}).catch(function(){})},dataDel:function(t){var e=this;if(0!==t.row.replyCommentNum)return this.$message.warning("请先删除已启用的回复评论");this.$confirm("此操作将永久删除该评论以及其回复评论, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$api.article.commentDel(t.row._id).then(function(t){var a=t.code;a===e.$constant.reqSuccess?(e.getDataList(),e.$message.success("评论删除成功")):a===e.$constant.dataAlready?e.$message.warning("请先删除已启用的回复评论"):e.$message.warning("评论删除失败")})}).catch(function(){})},replyCommentDel:function(t){var e=this,a=this.dialogBox.index;this.$confirm("此操作将删除其回复评论, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$api.article.replyCommentDel(t).then(function(t){t.code===e.$constant.reqSuccess?(e.dialogBox.detailItem=t.data,e.tableData.dataList[a]=t.data,e.$set(e.tableData.dataList,a,e.tableData.dataList[a]),e.$message.success("回复评论删除成功")):e.$message.warning("回复评论删除失败")})}).catch(function(){})},pageChange:function(t){this.pageObj.currentPage=t,this.getDataList(!0)}},components:{MyTable:n.a,MyForm:i.a,EmptyShow:s.a},computed:{authList:function(){return this.$store.getters.getAuthList}}}),r={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"wrapper"},[a("h2",{staticClass:"content-title"},[t._v("文章评论"+t._s(t.articleTitle?"——"+t.articleTitle:""))]),t._v(" "),a("div",{staticClass:"box-table"},[a("my-form",{ref:t.searchForm.ref,attrs:{formConfig:t.searchForm}}),t._v(" "),a("my-table",{attrs:{tableData:t.tableData,pageObj:t.pageObj},on:{sortChange:t.sortChange,pageChange:t.pageChange}})],1),t._v(" "),a("el-dialog",{attrs:{title:"评论回复",visible:t.dialogBox.boxShow,width:"720px","lock-scroll":!0},on:{"update:visible":function(e){return t.$set(t.dialogBox,"boxShow",e)}}},[a("div",{staticClass:"comment-box"},[a("empty-show",{attrs:{hide:t.dialogBox.detailItem.replyCommentList&&0===t.dialogBox.detailItem.replyCommentList.length,showTxt:"暂无评论",imgWidth:"100px",imgHeight:"90px"}}),t._v(" "),a("div",{staticClass:"box-list"},t._l(t.dialogBox.detailItem.replyCommentList,function(e,n){return a("div",{key:e._id,staticClass:"list-item"},[a("el-image",{staticClass:"image-circle",attrs:{src:t.baseURL+"/file/down?downId="+e.replyUser.avatarId}},[a("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[a("i",{staticClass:"el-icon-user-solid"})])]),t._v(" "),a("div",{staticClass:"item-content"},[a("div",{staticClass:"content-operate"},[a("div",{staticClass:"operate-user"},[a("span",{staticClass:"user-name"},[t._v(t._s(e.replyUser.name))]),t._v(" "),a("span",{staticClass:"comment-time"},[a("i",{staticClass:"el-icon-time"}),t._v(t._s(e.createTime))])]),t._v(" "),a("div",{staticClass:"operate-data"},[t.authList.includes("5e834f77fb69305aa091e82b")?a("el-button",{attrs:{type:"1"===e.status?"info":"success",size:"mini",icon:"1"===e.status?"el-icon-circle-close":"el-icon-circle-check"},on:{click:function(a){return t.replyCommentStatus(e)}}},[t._v(t._s("1"===e.status?"禁用":"启用"))]):t._e(),t._v(" "),t.authList.includes("5e834f77fb69305aa091e82b")?a("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-edit"},on:{click:function(a){return t.replyCommentEdit(e)}}},[t._v("编辑")]):t._e(),t._v(" "),t.authList.includes("5e834f77fb69305aa091e82b")?a("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-edit-outline"},on:{click:function(a){return t.replyComment(e)}}},[t._v("回复")]):t._e(),t._v(" "),t.authList.includes("5e834f7efb69305aa091e82c")?a("el-button",{attrs:{type:"danger",size:"mini",icon:"el-icon-delete"},on:{click:function(a){return t.replyCommentDel(e._id)}}},[t._v("删除")]):t._e()],1)]),t._v(" "),a("div",{staticClass:"content-replay"},[a("span",{directives:[{name:"show",rawName:"v-show",value:e.toUser&&e.toUser._id!==e.replyUser._id,expression:"item.toUser && item.toUser._id !==  item.replyUser._id"}],staticClass:"replay-user"},[t._v("\n                    回复 "),a("i",[t._v(t._s(e.toUser?e.toUser.name:"--"))]),t._v(" 的评论：\n                  ")]),t._v(" "),a("span",[t._v("\n                    "+t._s(e.content)+"\n                  ")])])])],1)}),0)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogBox.boxShow=!1}}},[t._v("取消")]),t._v(" "),t.authList.includes("5e834f6ffb69305aa091e82a")?a("el-button",{attrs:{type:"primary"},on:{click:t.replyCommentAdd}},[t._v("新增")]):t._e()],1)])],1)},staticRenderFns:[]};var c=a("VU/8")(o,r,!1,function(t){a("NC5g")},"data-v-02f5538e",null);e.default=c.exports},NC5g:function(t,e){}});